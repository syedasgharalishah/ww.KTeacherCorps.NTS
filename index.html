<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 10 Quiz - EDUCATION DEPARTMENT SCREENING TEST PREPARATION – June 28, 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Disable right-click, specific keyboard shortcuts (Ctrl+U, Ctrl+Shift+I, Ctrl+Shift+J, F12), copy, and paste */
        body {
            -webkit-touch-callout: none; /* iOS Safari */
            -webkit-user-select: none; /* Safari */
            -khtml-user-select: none; /* Konqueror HTML */
            -moz-user-select: none; /* Old versions of Firefox */
            -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently supported by Chrome, Edge, Opera and Firefox */
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F9FA; /* Very light gray */
            color: #2C3E50; /* Main text color */
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Full viewport height */
            overflow-x: hidden; /* Prevent horizontal scrolling */
        }

        /* Top Bar Styling */
        .top-bar {
            background-color: #ffffff;
            border-bottom: 1px solid #e0e0e0;
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .top-bar .date-display {
            color: #6D6875;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .top-bar .whatsapp-link {
            color: #6D6875;
            text-decoration: none;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Header Section Styling */
        .header-section {
            background-color: #ffffff;
            padding: 1.5rem 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 1rem;
        }

        .quiz-title {
            font-family: 'Roboto', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: #2C3E50;
            margin-bottom: 1rem;
        }

        .progress-bar-container {
            width: 80%;
            max-width: 600px;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin: 1rem auto;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #20B2AA, #3EB489); /* Teal to Mint Green */
            border-radius: 5px;
            transition: width 0.3s ease-in-out;
        }

        .banner-logo {
            max-width: 200px;
            height: auto;
            border-radius: 8px;
            margin-top: 1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .credits {
            font-size: 0.85rem;
            color: #6D6875;
            margin-top: 0.5rem;
        }

        /* Card Styling (for login, quiz, results pages) */
        .card {
            background-color: #FFF5EE; /* PeachPuff - very light, warm tone */
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin: 1rem auto;
            max-width: 700px;
            width: 90%;
            box-sizing: border-box;
        }

        /* Button Styling */
        .button-gradient {
            background-image: linear-gradient(to right, #E6E6FA, #FFDAB9); /* Lavender to PeachPuff - light and attractive */
            color: #2C3E50; /* Dark text for contrast */
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            border: none;
        }

        .button-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .button-gradient:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .option-button {
            background-color: #ffffff;
            border: 1px solid #ddd; /* Light border */
            padding: 0.75rem 1rem;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 0.75rem;
            color: #2C3E50;
            font-weight: normal;
        }

        .option-button:hover:not(.selected) {
            background-color: #f0f0f0; /* Slightly darker on hover */
        }

        .option-button.selected {
            border-color: #6D6875; /* Medium gray for selected */
            background-color: #f0f0f0;
            font-weight: bold;
        }

        .option-button.correct {
            background-color: #90EE90; /* LightGreen */
            border-color: #28a745; /* Darker green border */
            animation: pulse-green 0.5s ease-out forwards;
        }

        .option-button.incorrect {
            background-color: #FF6B6B; /* Light Red */
            border-color: #dc3545; /* Darker red border */
            animation: shake-red 0.5s ease-out forwards;
        }

        /* Special Question Styling */
        .special-question {
            border: 3px solid #FFD700; /* Gold border */
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); /* Glowing effect */
        }

        /* Explanation Section Styling */
        .explanation {
            background-color: #e0f7fa; /* Light Cyan */
            border-left: 5px solid #20B2AA; /* Teal border */
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 8px;
            color: #2C3E50;
            font-size: 0.9rem;
            display: none; /* Hidden by default */
        }

        /* Timer and Progress Display */
        .timer-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2C3E50;
            margin-bottom: 1rem;
            text-align: center;
        }

        .question-progress {
            font-size: 1rem;
            color: #6D6875;
            margin-bottom: 1rem;
            text-align: center;
        }

        /* Animations */
        @keyframes pulse-green {
            0% { transform: scale(1); }
            50% { transform: scale(1.01); }
            100% { transform: scale(1); }
        }

        @keyframes shake-red {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .top-bar {
                flex-direction: column;
                gap: 0.5rem;
                padding: 0.5rem;
            }
            .top-bar .date-display {
                order: 2; /* Move date to bottom on mobile */
                font-size: 0.8rem;
            }
            .top-bar .whatsapp-link {
                order: 1; /* Move whatsapp to top on mobile */
                font-size: 0.8rem;
            }
            .quiz-title {
                font-size: 1.5rem;
            }
            .banner-logo {
                max-width: 150px;
            }
            .card {
                margin: 0.75rem auto;
                padding: 1rem;
            }
            .button-gradient {
                padding: 0.6rem 1.2rem;
                font-size: 0.9rem;
            }
            .option-button {
                padding: 0.6rem 0.8rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>

    <script>
        // Disable right-click, specific keyboard shortcuts (Ctrl+U, Ctrl+Shift+I, Ctrl+Shift+J, F12), copy, and paste
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.addEventListener('keydown', e => {
            if (e.ctrlKey && (e.key === 'u' || e.key === 'U' || e.key === 'I' || e.key === 'i' || e.key === 'J' || e.key === 'j')) {
                e.preventDefault();
            }
            if (e.key === 'F12') {
                e.preventDefault();
            }
        });
        document.addEventListener('copy', event => event.preventDefault());
        document.addEventListener('paste', event => event.preventDefault());
    </script>

    <div class="top-bar">
        <a href="https://chat.whatsapp.com/H3uhXoDodPmAOaVvi3PcZq" target="_blank" class="whatsapp-link">
            <i class="fab fa-whatsapp"></i> Join WhatsApp Community
        </a>
        <div class="date-display" id="liveDate"></div>
    </div>

    <div class="header-section">
        <h1 class="quiz-title" id="quizTitle"></h1>
        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <img src="https://i.ibb.co/LXdkJVy8/20250524-0050-Empowering-Educators-remix-01jw0makvqewdvqns1te3jvpgs.png" alt="Banner Logo" class="banner-logo mx-auto">
        <div class="credits">
            KP Teacher Corps | PREPARED BY: SYED ASGHAR ALI SHAH | Contact: 03265762698
            <br>
            Updated on: <span id="updatedDate"></span>
        </div>
    </div>

    <main class="flex-grow flex items-center justify-center p-4">
        <!-- All page sections are initially hidden to prevent flicker -->
        <div id="loginPage" class="card hidden">
            <h2 class="text-xl font-bold mb-4 text-center">Login</h2>
            <div class="mb-4">
                <label for="loginId" class="block text-sm font-medium text-gray-700 mb-1">ID:</label>
                <input type="text" id="loginId" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" value="">
            </div>
            <div class="mb-6">
                <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-1">Password:</label>
                <input type="password" id="loginPassword" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" value="">
            </div>
            <p id="loginError" class="text-red-500 text-sm mb-4 hidden">Invalid ID or Password</p>
            <button id="loginBtn" class="button-gradient w-full">Login</button>
        </div>

        <div id="candidateNamePage" class="card hidden">
            <h2 class="text-xl font-bold mb-4 text-center">Candidate Information</h2>
            <div class="mb-6">
                <label for="candidateName" class="block text-sm font-medium text-gray-700 mb-1">Enter Full Name:</label>
                <input type="text" id="candidateName" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Your Full Name">
            </div>
            <p id="nameError" class="text-red-500 text-sm mb-4 hidden">Please enter your full name.</p>
            <button id="startQuizBtn" class="button-gradient w-full">Start Quiz</button>
        </div>

        <div id="quizPage" class="card hidden">
            <div class="timer-display" id="timerDisplay"></div>
            <div class="question-progress" id="questionProgress"></div>
            <h2 class="text-lg font-semibold mb-4" id="questionText"></h2>
            <div id="optionsContainer" class="flex flex-col gap-3 mb-6">
            </div>
            <div class="flex justify-between">
                <button id="prevBtn" class="button-gradient px-6 py-2">Previous</button>
                <button id="nextBtn" class="button-gradient px-6 py-2">Next</button>
                <button id="submitQuizBtn" class="button-gradient px-6 py-2 hidden">Submit Quiz</button>
            </div>
            <div id="explanationDiv" class="explanation"></div>
        </div>

        <div id="resultsPage" class="card hidden">
            <h2 class="text-xl font-bold mb-4 text-center">Quiz Results</h2>
            <p class="mb-2"><strong>Candidate Name:</strong> <span id="resultCandidateName"></span></p>
            <p class="mb-2"><strong>Date of Quiz:</strong> <span id="resultDate"></span></p>
            <p class="mb-2"><strong>Score:</strong> <span id="resultScore"></span> / <span id="maxScore"></span></p>
            <p class="mb-2"><strong>Correct Answers:</strong> <span id="resultCorrect"></span></p>
            <p class="mb-2"><strong>Incorrect Answers:</strong> <span id="resultIncorrect"></span></p>
            <p class="mb-4"><strong>Time Taken:</strong> <span id="resultTimeTaken"></span></p>
            <button id="restartQuizBtn" class="button-gradient w-full">Restart Quiz</button>
        </div>
    </main>

    <script>
        // Set the current date for display and logic
        const CURRENT_DATE_STR = "June 28, 2025";
        const CURRENT_DATE = new Date(CURRENT_DATE_STR);

        // Update header dates
        document.getElementById('liveDate').textContent = CURRENT_DATE_STR;
        document.getElementById('updatedDate').textContent = CURRENT_DATE_STR;
        document.getElementById('quizTitle').textContent = `Day 10 Quiz - EDUCATION DEPARTMENT SCREENING TEST PREPARATION – ${CURRENT_DATE_STR}`;

        // Quiz Data Structure
        const originalQuizQuestions = []; // Stores the initial, unshuffled questions
        let quizQuestions = []; // This array will be shuffled and used for the current quiz
        let currentQuestionIndex = 0;
        // Stores { questionIndex: int (original index), selectedOptionIndex: int (index in shuffled options), isCorrect: bool, originalCorrectOptionIndex: int }
        let userAnswers = []; 
        let quizStartTime;
        let timerInterval;
        const QUIZ_DURATION_MINUTES = 40; // Default quiz duration
        let specialQuestionOriginalIndex = -1; // To store the original index of the special question

        // --- Helper Functions ---

        /**
         * Shuffles an array in place using Fisher-Yates (Knuth) shuffle.
         * @param {Array} array - The array to shuffle.
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /**
         * Converts seconds to a human-readable time string (e.g., "35 minutes 10 seconds").
         * @param {number} totalSeconds - The total number of seconds.
         * @returns {string} Formatted time string.
         */
        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes} minutes ${seconds} seconds`;
        }

        /**
         * Updates the progress bar and question progress text.
         */
        function updateProgressBar() {
            const progress = ((currentQuestionIndex + 1) / quizQuestions.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('questionProgress').textContent = `Question ${currentQuestionIndex + 1}/${quizQuestions.length} – ${Math.round(progress)}% Complete`;
        }

        /**
         * Displays a specific page and hides others.
         * @param {string} pageId - The ID of the page to display.
         */
        function showPage(pageId) {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('candidateNamePage').classList.add('hidden');
            document.getElementById('quizPage').classList.add('hidden');
            document.getElementById('resultsPage').classList.add('hidden');
            document.getElementById(pageId).classList.remove('hidden');
        }

        /**
         * Starts the quiz timer.
         */
        function startTimer() {
            quizStartTime = Date.now();
            let timeLeft = QUIZ_DURATION_MINUTES * 60; // Convert minutes to seconds

            function updateTimerDisplay() {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                document.getElementById('timerDisplay').textContent = `Time Left: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz(true); // Auto-submit on timer expiry
                } else {
                    timeLeft--;
                }
            }

            updateTimerDisplay(); // Initial display
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        /**
         * Renders the current question and its options.
         */
        function renderQuestion() {
            const question = quizQuestions[currentQuestionIndex];
            document.getElementById('questionText').innerHTML = question.question;
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = ''; // Clear previous options

            // Remove special-question class from previous question if any
            const quizCard = document.getElementById('quizPage');
            quizCard.classList.remove('special-question');

            // Add special-question class if it's today's special question and date matches
            const today = new Date().toDateString();
            if (question.special && CURRENT_DATE.toDateString() === today) {
                quizCard.classList.add('special-question');
            }
            
            // Create a shuffled copy of the options for the current question
            // We need to store the original index mapping before shuffling
            const shuffledOptionsWithOriginalIndex = question.options.map((option, index) => ({
                optionText: option,
                originalIndex: index
            }));
            shuffleArray(shuffledOptionsWithOriginalIndex);

            // Store the shuffled options and their original correct index for this question
            // This allows us to track the correct option even after shuffling
            quizQuestions[currentQuestionIndex].shuffledOptions = shuffledOptionsWithOriginalIndex;
            quizQuestions[currentQuestionIndex].shuffledCorrectOptionIndex = shuffledOptionsWithOriginalIndex.findIndex(
                opt => opt.originalIndex === question.correctOptionIndex
            );

            shuffledOptionsWithOriginalIndex.forEach((optionObj, index) => {
                const button = document.createElement('button');
                button.classList.add('option-button', 'w-full');
                button.innerHTML = optionObj.optionText; // Use innerHTML to render LaTeX
                button.dataset.shuffledOptionIndex = index; // Store the shuffled index
                button.onclick = () => selectOption(index);

                // Apply selected state if already answered
                const userAnswer = userAnswers[currentQuestionIndex];
                if (userAnswer && userAnswer.selectedOptionIndex === index) {
                    button.classList.add('selected');
                    if (userAnswer.isCorrect) {
                        button.classList.add('correct');
                    } else {
                        button.classList.add('incorrect');
                    }
                    // Disable all options if already answered
                    Array.from(optionsContainer.children).forEach(optBtn => optBtn.disabled = true);
                    document.getElementById('explanationDiv').style.display = 'block';
                }
                optionsContainer.appendChild(button);
            });

            // Render math equations using MathJax if available
            if (typeof MathJax !== 'undefined') {
                MathJax.typesetPromise([document.getElementById('questionText'), optionsContainer]);
            }


            // Show/hide explanation
            const explanationDiv = document.getElementById('explanationDiv');
            explanationDiv.innerHTML = `<p class="font-bold">Explanation:</p><p>${question.explanation}</p>`;
            if (typeof MathJax !== 'undefined') {
                MathJax.typesetPromise([explanationDiv]);
            }
            if (userAnswers[currentQuestionIndex] && userAnswers[currentQuestionIndex].selectedOptionIndex !== undefined) {
                explanationDiv.style.display = 'block';
            } else {
                explanationDiv.style.display = 'none';
            }

            // Update navigation buttons visibility
            document.getElementById('prevBtn').classList.toggle('hidden', currentQuestionIndex === 0);
            document.getElementById('nextBtn').classList.toggle('hidden', currentQuestionIndex === quizQuestions.length - 1);
            document.getElementById('submitQuizBtn').classList.toggle('hidden', currentQuestionIndex !== quizQuestions.length - 1);

            updateProgressBar();
        }

        /**
         * Handles option selection by the user.
         * @param {number} selectedOptionIndex - The index of the selected option from the SHUFFLED options.
         */
        function selectOption(selectedOptionIndex) {
            const question = quizQuestions[currentQuestionIndex];
            const isCorrect = (selectedOptionIndex === question.shuffledCorrectOptionIndex);

            // Store user's answer
            userAnswers[currentQuestionIndex] = {
                questionIndex: currentQuestionIndex,
                selectedOptionIndex: selectedOptionIndex, // This is the index in the SHUFFLED options
                isCorrect: isCorrect,
                originalCorrectOptionIndex: question.correctOptionIndex // Store original correct index for reference if needed
            };

            // Apply visual feedback
            const optionsContainer = document.getElementById('optionsContainer');
            Array.from(optionsContainer.children).forEach((button, index) => {
                button.disabled = true; // Disable all options after selection
                button.classList.remove('selected', 'correct', 'incorrect'); // Clear previous states

                if (index === selectedOptionIndex) {
                    button.classList.add('selected');
                    if (isCorrect) {
                        button.classList.add('correct');
                    } else {
                        button.classList.add('incorrect');
                    }
                } else if (index === question.shuffledCorrectOptionIndex) {
                    // Highlight the correct answer even if not selected by the user
                    button.classList.add('correct');
                }
            });

            // Show explanation
            document.getElementById('explanationDiv').style.display = 'block';
             // Render math equations in explanation
            if (typeof MathJax !== 'undefined') {
                MathJax.typesetPromise([document.getElementById('explanationDiv')]);
            }
        }

        /**
         * Navigates to the next question.
         */
        function nextQuestion() {
            if (currentQuestionIndex < quizQuestions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            }
        }

        /**
         * Navigates to the previous question.
         */
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        /**
         * Submits the quiz, calculates results, and displays them.
         * @param {boolean} isAutoSubmit - True if submitted by timer, false otherwise.
         */
        function submitQuiz(isAutoSubmit = false) {
            clearInterval(timerInterval); // Stop the timer

            const endTime = Date.now();
            const timeTakenSeconds = Math.round((endTime - quizStartTime) / 1000);

            let correctCount = 0;
            let incorrectCount = 0;
            let totalAttempted = 0;

            userAnswers.forEach(answer => {
                if (answer && answer.selectedOptionIndex !== undefined) {
                    totalAttempted++;
                    if (answer.isCorrect) {
                        correctCount++;
                    } else {
                        incorrectCount++;
                    }
                }
            });

            const maxPossibleScore = quizQuestions.length * 2; // 2 points per question
            const score = (correctCount * 2) - incorrectCount; // Score calculation: 2 for correct, -1 for incorrect

            const candidateName = document.getElementById('candidateName').value;

            document.getElementById('resultCandidateName').textContent = candidateName;
            document.getElementById('resultDate').textContent = CURRENT_DATE_STR;
            document.getElementById('resultScore').textContent = score;
            document.getElementById('maxScore').textContent = maxPossibleScore;
            document.getElementById('resultCorrect').textContent = `${correctCount} / ${totalAttempted}`;
            document.getElementById('resultIncorrect').textContent = `${incorrectCount} / ${totalAttempted}`;
            document.getElementById('resultTimeTaken').textContent = formatTime(timeTakenSeconds);

            showPage('resultsPage');

            // Silent Formspree submission
            const formData = new FormData();
            formData.append('Candidate Name', candidateName);
            formData.append('Date of Quiz', CURRENT_DATE_STR);
            formData.append('Score', score);
            formData.append('Correct Answers', correctCount);
            formData.append('Incorrect Answers', incorrectCount);
            formData.append('Time Taken', formatTime(timeTakenSeconds));
            formData.append('Quiz ID', "day10"); // Specific ID for Day 10 quiz

            fetch('https://formspree.io/f/xwpojgab', {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            }).then(response => {
                if (response.ok) {
                    console.log('Quiz results submitted successfully!');
                } else {
                    console.error('Formspree submission failed.');
                }
            }).catch(error => {
                console.error('Error during Formspree submission:', error);
            });
        }

        // --- Event Listeners ---

        document.getElementById('loginBtn').addEventListener('click', () => {
            const id = document.getElementById('loginId').value;
            const password = document.getElementById('loginPassword').value;
            const loginError = document.getElementById('loginError');

            // Specific credentials for Day 10
            if (id === 'day10' && password === '1010') {
                loginError.classList.add('hidden');
                showPage('candidateNamePage');
            } else {
                loginError.classList.remove('hidden');
            }
        });

        document.getElementById('startQuizBtn').addEventListener('click', () => {
            const candidateNameInput = document.getElementById('candidateName');
            const candidateName = candidateNameInput.value.trim();
            const nameError = document.getElementById('nameError');

            if (candidateName) {
                nameError.classList.add('hidden');
                // Initialize userAnswers array for the new quiz attempt
                userAnswers = new Array(quizQuestions.length).fill(null);
                currentQuestionIndex = 0;
                startTimer();
                renderQuestion();
                showPage('quizPage');
            } else {
                nameError.classList.remove('hidden');
            }
        });

        document.getElementById('nextBtn').addEventListener('click', nextQuestion);
        document.getElementById('prevBtn').addEventListener('click', prevQuestion);
        document.getElementById('submitQuizBtn').addEventListener('click', () => {
            // Optional: Add a confirmation dialog before submitting
            if (confirm("Are you sure you want to submit the quiz? You cannot change your answers after submission.")) {
                submitQuiz(false);
            }
        });
        document.getElementById('restartQuizBtn').addEventListener('click', () => {
            // Optional: Add a confirmation dialog before restarting
            if (confirm("Are you sure you want to restart the quiz? Your current progress will be lost.")) {
                // Reset quiz state
                currentQuestionIndex = 0;
                userAnswers = [];
                clearInterval(timerInterval); // Clear any lingering timer
                // Re-initialize and re-shuffle questions for a new attempt
                initializeQuiz(); 
                // Clear login fields and go back to login page
                document.getElementById('loginId').value = '';
                document.getElementById('loginPassword').value = '';
                document.getElementById('candidateName').value = '';
                showPage('loginPage');
            }
        });

        // --- Quiz Initialization ---
        function initializeQuiz() {
            // Populate originalQuizQuestions (only once) if not already populated
            if (originalQuizQuestions.length === 0) {
                // Pedagogy (20 MCQs from Pages 37-80)
                const pedagogyMCQs = [
                    { question: "What does the Latin word 'Educare' mean?", options: ["To lead out", "To draw forth", "To nourish, bring up", "To teach"], correctOptionIndex: 2, explanation: "Educare means to nourish, to bring up (Page 37)." },
                    { question: "The word 'Educere' means:", options: ["To teach", "To lead forth", "To educate", "To evaluate"], correctOptionIndex: 1, explanation: "Educere means to lead forth, to draw out (Page 37)." },
                    { question: "The Latin word 'Educatum' is composed of which two terms?", options: ["$E$ and $C$", "$E$ and $Duco$", "Ex and Domus", "Ed and Ducare"], correctOptionIndex: 1, explanation: "'E' implies a movement from inward to outward, and 'Duco' means developing or progressing (Page 37)." },
                    { question: "Education is defined as 'Positive change in behavior or mind of individual, society or community life according to the need and demand of society'. This definition is:", options: ["Incorrect", "Incomplete", "Correct", "Outdated"], correctOptionIndex: 2, explanation: "This is a comprehensive definition of education (Page 37)." },
                    { question: "What is the relationship between 'learning' and 'education'?", options: ["Learning is product", "Education is product", "They are same", "They are unrelated"], correctOptionIndex: 1, explanation: "Learning is the underlying process of acquiring knowledge, and education is the structured system providing it (Page 37)." },
                    { question: "Formal education typically takes place in the premises of:", options: ["Home", "Society", "School", "Marketplace"], correctOptionIndex: 2, explanation: "Formal education is characterized by its institutional setting (Page 37)." },
                    { question: "Which type of education is spontaneous, lifelong, and occurs through daily experiences?", options: ["Formal", "Non-formal", "Informal", "Higher"], correctOptionIndex: 2, explanation: "Informal education is natural and continuous, occurring without a fixed syllabus or timetable (Page 37)." },
                    { question: "Which type of education is organized outside the formal system, often catering to specific needs or groups with flexible curriculum?", options: ["Formal", "Informal", "Non-formal", "Basic"], correctOptionIndex: 2, explanation: "Non-formal education aims to meet specific learning needs of particular groups (Page 38)." },
                    { question: "School grading/certification and university degrees are examples of:", options: ["Informal", "Non-formal", "Formal", "Self-education"], correctOptionIndex: 2, explanation: "These are structured outcomes of formal educational systems (Page 37)." },
                    { question: "A parent teaching a child how to prepare a meal is an example of:", options: ["Formal", "Non-formal", "Informal", "Vocational"], correctOptionIndex: 2, explanation: "Learning everyday life skills from parents falls under informal education (Page 38)." },
                    { question: "One characteristic of formal education is that it is:", options: ["Flexible", "Not pre-planned", "Structured hierarchically", "Without assessments"], correctOptionIndex: 2, explanation: "Formal education follows a defined structure and progression (Page 37)." },
                    { question: "A disadvantage of formal education is that brilliant students may be bored due to:", options: ["Lack of teachers", "Long wait for session", "Too much homework", "Lack of activities"], correctOptionIndex: 1, explanation: "The rigid chronological grading system can lead to boredom for advanced learners (Page 38)." },
                    { question: "Informal education has no definite syllabus, no timetable, and requires:", options: ["Regular fees", "Certificates/degrees", "No fees", "Strict discipline"], correctOptionIndex: 2, explanation: "Informal learning is part of daily life and doesn't involve formal costs or certifications (Page 38)." },
                    { question: "What is a characteristic of non-formal education?", options: ["Rigid and standardized.", "Flexible and learner-centered.", "Leads to university degree.", "Unorganized and accidental."], correctOptionIndex: 1, explanation: "Non-formal education adapts to the needs of the learners (Page 38)." },
                    { question: "An advantage of non-formal education is that it:", options: ["Is highly expensive", "Has fixed time", "Helps vocational skills", "Is recognized globally"], correctOptionIndex: 2, explanation: "Non-formal education often focuses on practical skills and job readiness (Page 38)." },
                    { question: "Who said 'Education is the manifestation of perfection already in man'?", options: ["Mahatma Gandhi", "Swami Vivekananda", "John Dewey", "Rabindranath Tagore"], correctOptionIndex: 1, explanation: "This quote emphasizes the inherent potential within each individual (Page 41)." },
                    { question: "The philosophy that emphasizes eternal truths and values, often through classical literature and art, is:", options: ["Progressivism", "Existentialism", "Perennialism", "Reconstructionism"], correctOptionIndex: 2, explanation: "Perennialism focuses on timeless ideas and universal truths (Page 41)." },
                    { question: "Which philosophy believes that education should focus on personal meaning and individual freedom?", options: ["Idealism", "Realism", "Existentialism", "Pragmatism"], correctOptionIndex: 2, explanation: "Existentialism prioritizes individual choice and responsibility (Page 41)." },
                    { question: "What is the aim of education according to 'Idealism'?", options: ["Prepare for life.", "Develop self-actualization.", "Seek universal truths.", "Foster social change."], correctOptionIndex: 2, explanation: "Idealism emphasizes the development of character and spiritual values (Page 42)." },
                    { question: "Which philosophy emphasizes that education should be based on observation, scientific method, and objective reality?", options: ["Idealism", "Realism", "Pragmatism", "Existentialism"], correctOptionIndex: 1, explanation: "Realism focuses on the objective world and empirical data (Page 42)." }
                ];
                originalQuizQuestions.push(...pedagogyMCQs);

                // General Science (25 MCQs from Pages 271-320)
                const generalScienceMCQs = [
                    { question: "What is 'force' in physics?", options: ["Energy", "Power", "Push or pull", "Work"], correctOptionIndex: 2, explanation: "Force is a vector quantity, having both magnitude and direction (Page 271)." },
                    { question: "What is the unit of force in the SI system?", options: ["Joule", "Watt", "Newton", "Pascal"], correctOptionIndex: 2, explanation: "One Newton is the force required to accelerate a mass of one kilogram at one meter per second squared (Page 271)." },
                    { question: "What is 'pressure'?", options: ["Force per length", "Force per area", "Force per volume", "Force per time"], correctOptionIndex: 1, explanation: "Pressure is calculated as force divided by area ($P = F/A$) (Page 272)." },
                    { question: "What is the SI unit of pressure?", options: ["Newton", "Joule", "Pascal", "Watt"], correctOptionIndex: 2, explanation: "One Pascal is equivalent to one Newton per square meter ($1 Pa = 1 N/m^2$) (Page 272)." },
                    { question: "What happens to pressure as the area over which a force is applied decreases?", options: ["Increases", "Decreases", "Stays same", "Becomes zero"], correctOptionIndex: 0, explanation: "Pressure and area are inversely proportional for a given force (Page 273)." },
                    { question: "What is 'gravity'?", options: ["Repulsive force.", "Attractive force of mass.", "Opposing motion force.", "Buoyancy force."], correctOptionIndex: 1, explanation: "Gravity is responsible for objects falling to Earth (Page 274)." },
                    { question: "Who formulated the Law of Universal Gravitation?", options: ["Einstein", "Galilei", "Newton", "Kepler"], correctOptionIndex: 2, explanation: "Newton's law describes the gravitational attraction between two bodies (Page 275)." },
                    { question: "What is 'friction'?", options: ["Accelerates objects.", "Opposes motion between surfaces.", "Pulls objects.", "Creates heat."], correctOptionIndex: 1, explanation: "Friction can be beneficial (like walking) or detrimental (like wear and tear) (Page 276)." },
                    { question: "Which type of friction occurs when an object is sliding over a surface?", options: ["Static", "Rolling", "Sliding", "Fluid"], correctOptionIndex: 2, explanation: "Sliding friction acts against the direction of motion (Page 277)." },
                    { question: "Which type of friction is present when an object is at rest on a surface with tendency to move?", options: ["Sliding", "Rolling", "Static", "Fluid"], correctOptionIndex: 2, explanation: "Static friction is usually greater than kinetic friction (Page 278)." },
                    { question: "What is 'work' in physics?", options: ["Effort", "Force times distance", "Energy expended", "Power generated"], correctOptionIndex: 1, explanation: "Work is done only when there is displacement in the direction of the applied force ($W = F \\times d$) (Page 279)." },
                    { question: "What is the SI unit of work?", options: ["Watt", "Newton", "Joule", "Pascal"], correctOptionIndex: 2, explanation: "One Joule is defined as one Newton-meter (Page 279)." },
                    { question: "What is 'energy'?", options: ["Rate work done.", "Ability to do work.", "Force over distance.", "Heat capacity."], correctOptionIndex: 1, explanation: "Energy exists in various forms like kinetic, potential, thermal, etc. (Page 280)." },
                    { question: "Which form of energy is associated with motion?", options: ["Potential", "Chemical", "Kinetic", "Thermal"], correctOptionIndex: 2, explanation: "Kinetic energy depends on mass and velocity ($KE = 1/2 mv^2$) (Page 281)." },
                    { question: "Which form of energy is stored energy due to position or state?", options: ["Kinetic", "Thermal", "Potential", "Electrical"], correctOptionIndex: 2, explanation: "Gravitational potential energy depends on mass, gravity, and height ($PE = mgh$) (Page 282)." },
                    { question: "What is 'power' in physics?", options: ["Object's energy.", "Rate of work.", "Force times velocity.", "Exert force ability."], correctOptionIndex: 1, explanation: "Power is work done per unit time ($P = W/t$) (Page 283)." },
                    { question: "What is the SI unit of power?", options: ["Joule", "Newton", "Watt", "Pascal"], correctOptionIndex: 2, explanation: "One Watt is defined as one Joule per second (Page 283)." },
                    { question: "What is 'light'?", options: ["Sound energy.", "Visible EM radiation.", "Heat energy.", "Chemical reaction."], correctOptionIndex: 1, explanation: "Light travels in waves and as particles (photons) (Page 284)." },
                    { question: "What is the 'spectrum' of light?", options: ["Rainbow colors.", "Range of EM frequencies.", "Light intensity.", "Light speed."], correctOptionIndex: 1, explanation: "The electromagnetic spectrum includes radio waves, microwaves, infrared, visible light, ultraviolet, X-rays, and gamma rays (Page 285)." },
                    { question: "Which color of visible light has the longest wavelength?", options: ["Blue", "Green", "Red", "Violet"], correctOptionIndex: 2, explanation: "Red light bends the least when passing through a prism (Page 286)." },
                    { question: "Which color of visible light has the shortest wavelength?", options: ["Red", "Orange", "Green", "Violet"], correctOptionIndex: 3, explanation: "Violet light bends the most when passing through a prism (Page 286)." },
                    { question: "What causes 'refraction' of light?", options: ["Light hitting surface.", "Light passing media.", "Light reflecting mirror.", "Light scattering."], correctOptionIndex: 1, explanation: "Refraction causes objects to appear bent in water (Page 287)." },
                    { question: "What is 'reflection' of light?", options: ["Light bending lens.", "Light bouncing surface.", "Light splitting colors.", "Light absorbed."], correctOptionIndex: 1, explanation: "Mirrors demonstrate reflection (Page 288)." },
                    { question: "What is 'sound'?", options: ["EM wave.", "Mechanical energy vibration.", "Chemical energy.", "Form of light."], correctOptionIndex: 1, explanation: "Sound requires a medium (solid, liquid, or gas) to travel (Page 289)." },
                    { question: "Through which medium does sound travel fastest?", options: ["Gas", "Liquid", "Solid", "Vacuum"], correctOptionIndex: 2, explanation: "The particles in solids are closer together, allowing vibrations to transmit more efficiently (Page 290)." }
                ];
                originalQuizQuestions.push(...generalScienceMCQs);

                // Social Studies (20 MCQs from Pages 591-618 - Geography: Natural Disasters and Environmental Issues)
                const socialStudiesMCQs = [
                    { question: "What is an 'earthquake'?", options: ["Volcanic eruption.", "Ground shaking.", "Severe storm.", "Long drought."], correctOptionIndex: 1, explanation: "Earthquakes are caused by tectonic plate movements (Page 591)." },
                    { question: "What is the instrument used to measure the intensity of an earthquake?", options: ["Anemometer", "Barometer", "Seismograph", "Thermometer"], correctOptionIndex: 2, explanation: "A seismograph detects and records ground motion (Page 592)." },
                    { question: "What is the point on the Earth's surface directly above the focus of an earthquake?", options: ["Focus", "Epicenter", "Fault line", "Trench"], correctOptionIndex: 1, explanation: "The epicenter is where earthquake damage is often most severe (Page 592)." },
                    { question: "What is a 'tsunami'?", options: ["Strong wind storm.", "Large sea wave.", "Flash flood.", "Desert storm."], correctOptionIndex: 1, explanation: "Tsunamis are not tidal waves (Page 593)." },
                    { question: "What is a 'volcano'?", options: ["Deep ocean trench.", "Erupting mountain.", "Large cave system.", "Type of forest."], correctOptionIndex: 1, explanation: "Volcanoes are formed by molten rock (magma) rising to the surface (Page 594)." },
                    { question: "What is 'lava'?", options: ["Molten rock inside.", "Molten rock erupted.", "Ash and gas.", "Solidified rock."], correctOptionIndex: 1, explanation: "Lava is magma that has reached the surface (Page 595)." },
                    { question: "What is a 'flood'?", options: ["A dry period.", "Water overflow.", "Type of earthquake.", "Strong ocean current."], correctOptionIndex: 1, explanation: "Floods can be caused by heavy rainfall, melting snow, or dam failures (Page 596)." },
                    { question: "What is a 'drought'?", options: ["Excessive rainfall.", "Prolonged low rainfall.", "A type of storm.", "Sudden water increase."], correctOptionIndex: 1, explanation: "Droughts have significant impacts on agriculture and water supply (Page 597)." },
                    { question: "What is a 'cyclone' or 'hurricane'?", options: ["Type of earthquake.", "Large rotating storm.", "Gentle breeze.", "Small localized storm."], correctOptionIndex: 1, explanation: "These terms refer to the same weather phenomenon but are used in different regions (Page 598)." },
                    { question: "What is 'global warming'?", options: ["Localized heat increase.", "Earth's temp increase.", "Temp decrease.", "Ocean current change."], correctOptionIndex: 1, explanation: "Global warming is a major aspect of climate change (Page 599)." },
                    { question: "What is the 'greenhouse effect'?", options: ["Earth cooling.", "Natural Earth warming.", "Grow plants indoors.", "Creates ozone."], correctOptionIndex: 1, explanation: "Without the greenhouse effect, Earth would be too cold to support life (Page 599)." },
                    { question: "Which gas is considered the primary greenhouse gas contributing to global warming?", options: ["Oxygen", "Nitrogen", "Carbon dioxide", "Methane"], correctOptionIndex: 2, explanation: "Carbon dioxide is released primarily through the burning of fossil fuels (Page 600)." },
                    { question: "What is 'ozone depletion'?", options: ["Ozone increase.", "Ozone layer thinning.", "New ozone formation.", "Ozone pollution."], correctOptionIndex: 1, explanation: "Ozone depletion allows more harmful UV radiation to reach Earth's surface (Page 601)." },
                    { question: "What are 'CFCs' (chlorofluorocarbons) primarily responsible for?", options: ["Acid rain", "Water pollution", "Ozone depletion", "Smog formation"], correctOptionIndex: 2, explanation: "CFCs were widely used in refrigerants and aerosols (Page 601)." },
                    { question: "What is 'acid rain'?", options: ["Normal rainfall.", "Acidic rainfall.", "High mineral rain.", "Desert rain."], correctOptionIndex: 1, explanation: "Acid rain is caused by sulfur dioxide and nitrogen oxides (Page 602)." },
                    { question: "What is 'biodiversity'?", options: ["Human cultures.", "Life variety.", "Rock types.", "Climate change."], correctOptionIndex: 1, explanation: "Biodiversity is crucial for ecosystem health and stability (Page 603)." },
                    { question: "What is 'habitat loss'?", options: ["New habitats.", "Habitat destruction.", "Ecosystem restoration.", "Protected area expansion."], correctOptionIndex: 1, explanation: "Habitat loss is a major driver of species extinction (Page 604)." },
                    { question: "What is an 'invasive species'?", options: ["Native species.", "Non-native harmful species.", "Multi-habitat species.", "Specific area species."], correctOptionIndex: 1, explanation: "Invasive species outcompete native species for resources (Page 605)." },
                    { question: "What is 'overpopulation'?", options: ["Balanced growth.", "Population exceeding capacity.", "Population decrease.", "Even distribution."], correctOptionIndex: 1, explanation: "Overpopulation puts strain on resources and infrastructure (Page 606)." },
                    { question: "What is 'waste management'?", options: ["More waste.", "Managing waste.", "Burning waste.", "Dumping waste."], correctOptionIndex: 1, explanation: "Effective waste management involves reduction, reuse, recycling, and proper disposal (Page 607)." }
                ];
                originalQuizQuestions.push(...socialStudiesMCQs);

                // English (20 MCQs from Pages 871-894 - Grammar & Comprehension)
                const englishMCQs = [
                    { question: "Identify the noun in the sentence: 'The cat sat on the mat.'", options: ["The", "sat", "cat", "on"], correctOptionIndex: 2, explanation: "'Cat' is a person, place, animal, or thing (Page 871)." },
                    { question: "Identify the verb in the sentence: 'Birds fly in the sky.'", options: ["Birds", "in", "sky", "fly"], correctOptionIndex: 3, explanation: "'Fly' is the action word in the sentence (Page 872)." },
                    { question: "Identify the adjective in the sentence: 'She wore a red dress.'", options: ["She", "wore", "red", "dress"], correctOptionIndex: 2, explanation: "'Red' describes the noun 'dress' (Page 873)." },
                    { question: "Identify the adverb in the sentence: 'He sings loudly.'", options: ["He", "sings", "loudly", "sings loudly"], correctOptionIndex: 2, explanation: "'Loudly' describes how he sings (Page 874)." },
                    { question: "Which of the following is a pronoun?", options: ["Table", "Run", "Beautiful", "He"], correctOptionIndex: 3, explanation: "Pronouns replace nouns (Page 875)." },
                    { question: "Complete the sentence with the correct article: 'I saw ___ elephant.'", options: ["a", "an", "the", "no article"], correctOptionIndex: 1, explanation: "'An' is used before words starting with a vowel sound (Page 876)." },
                    { question: "Complete the sentence with the correct article: 'She has ___ unique idea.'", options: ["a", "an", "the", "no article"], correctOptionIndex: 0, explanation: "'Unique' starts with a consonant sound (Page 877)." },
                    { question: "Which tense describes an action that happened in the past and is now complete?", options: ["Present simple", "Past continuous", "Past simple", "Future simple"], correctOptionIndex: 2, explanation: "Past simple is used for completed actions in the past (Page 878)." },
                    { question: "Which tense describes an action that is happening now?", options: ["Past simple", "Present continuous", "Future simple", "Present perfect"], correctOptionIndex: 1, explanation: "Present continuous uses 'is/am/are' + verb-ing (Page 879)." },
                    { question: "Identify the preposition in the sentence: 'The book is on the table.'", options: ["The", "book", "on", "table"], correctOptionIndex: 2, explanation: "'On' shows the relationship of the book to the table (Page 880)." },
                    { question: "Identify the conjunction in the sentence: 'I like apples and bananas.'", options: ["I", "like", "and", "apples"], correctOptionIndex: 2, explanation: "'And' joins two words or clauses (Page 881)." },
                    { question: "Identify the interjection in the sentence: 'Oh! I forgot my keys.'", options: ["I", "forgot", "keys", "Oh!"], correctOptionIndex: 3, explanation: "Interjections express sudden emotions (Page 882)." },
                    { question: "Choose the singular form of 'children'.", options: ["Childrens", "Child", "Child's", "Childrens'"], correctOptionIndex: 1, explanation: "'Child' is the singular form of 'children' (Page 883)." },
                    { question: "Choose the plural form of 'mouse'.", options: ["Mouses", "Mice", "Mouse's", "Mice's"], correctOptionIndex: 1, explanation: "The plural of 'mouse' is 'mice' (Page 884)." },
                    { question: "Complete the sentence: 'The sun ___ in the east.'", options: ["rise", "rises", "rising", "rose"], correctOptionIndex: 1, explanation: "Use present simple with third person singular subject (Page 885)." },
                    { question: "Complete the sentence: 'They ___ to the park yesterday.'", options: ["go", "goes", "went", "gone"], correctOptionIndex: 2, explanation: "Use the past simple form of the verb for a completed action in the past (Page 886)." },
                    { question: "Choose the correct sentence:", options: ["He don't like coffee.", "He doesn't like coffee.", "He not like coffee.", "He isn't like coffee."], correctOptionIndex: 1, explanation: "Use 'doesn't' for third person singular negative in present simple (Page 887)." },
                    { question: "Which of the following is a collective noun?", options: ["Student", "Tree", "Team", "Book"], correctOptionIndex: 2, explanation: "A collective noun refers to a group of individuals (Page 888)." },
                    { question: "What is the opposite of 'big'?", options: ["Large", "Huge", "Small", "Giant"], correctOptionIndex: 2, explanation: "Small is the antonym of big (Page 889)." },
                    { question: "What is the synonym of 'start'?", options: ["End", "Finish", "Begin", "Stop"], correctOptionIndex: 2, explanation: "Begin is a word with similar meaning to start (Page 890)." }
                ];
                originalQuizQuestions.push(...englishMCQs);

                // Mathematics (20 MCQs from Pages 1021-1050)
                const mathematicsMCQs = [
                    { question: "What is the concept of 'ratio'?", options: ["Sum of numbers.", "Quantity comparison.", "Product of numbers.", "Difference of numbers."], correctOptionIndex: 1, explanation: "Ratio expresses how many times one quantity contains another (Page 1021)." },
                    { question: "Simplify the ratio $15:25$.", options: ["$3:5$", "$5:3$", "$1:2$", "$2:3$"], correctOptionIndex: 0, explanation: "Divide both numbers by their greatest common divisor, which is $5$ ($15 \\div 5 = 3$, $25 \\div 5 = 5$) (Page 1021)." },
                    { question: "What is 'proportion'?", options: ["Relationship.", "Equal ratios statement.", "Inverse of ratio.", "Sum of ratios."], correctOptionIndex: 1, explanation: "Proportions are used to solve for unknown quantities when two ratios are equivalent (Page 1022)." },
                    { question: "If $2:3 = x:9$, what is the value of $x$?", options: ["$4$", "$6$", "$8$", "$12$"], correctOptionIndex: 1, explanation: "Cross-multiply: $2 \\times 9 = 3 \\times x \\implies 18 = 3x \\implies x = 6$ (Page 1022)." },
                    { question: "What is 'direct proportion'?", options: ["One quantity decreases.", "Quantities change together.", "Unrelated quantities.", "Constant quantity."], correctOptionIndex: 1, explanation: "In direct proportion, the ratio between quantities remains constant (Page 1023)." },
                    { question: "If $5$ apples cost $10, how much do $10$ apples cost (direct proportion)?", options: ["$15", "$20", "$25", "$30$"], correctOptionIndex: 1, explanation: "If $5$ apples cost $10, then $1$ apple costs $2. So, $10$ apples cost $10 \\times 2 = 20$ (Page 1023)." },
                    { question: "What is 'inverse proportion'?", options: ["Quantities change together.", "One increases, other decreases.", "Quantities always equal.", "Quantities added."], correctOptionIndex: 1, explanation: "In inverse proportion, their product remains constant (Page 1024)." },
                    { question: "If $3$ workers complete task in $10$ hours, how long for $6$ workers (inverse proportion)?", options: ["$3$ hours", "$4$ hours", "$5$ hours", "$6$ hours"], correctOptionIndex: 2, explanation: "Total work units = $3 \\times 10 = 30$. Time for $6$ workers = $30 \\div 6 = 5$ hours (Page 1024)." },
                    { question: "What is 'percentage'?", options: ["Fraction of $10$", "Fraction of $100$", "Decimal number", "Ratio."], correctOptionIndex: 1, explanation: "Percentage is a way of expressing a part of a whole as a fraction of $100$ (Page 1025)." },
                    { question: "Convert $0.25$ into a percentage.", options: ["$2.5\%$", "$25\%$", "$0.25\%$", "$250\%$"], correctOptionIndex: 1, explanation: "Multiply by $100$: $0.25 \\times 100 = 25\%$ (Page 1025)." },
                    { question: "Convert $75\%$ into a fraction in its simplest form.", options: ["$3/4$", "$1/2$", "$1/4$", "$4/5$"], correctOptionIndex: 0, explanation: "$75\% = 75/100 = 3/4$ (Page 1026)." },
                    { question: "If a shirt costs $200 and is on sale for $10\%$ off, what is the discount amount?", options: ["$10", "$20", "$30", "$40$"], correctOptionIndex: 1, explanation: "Discount = $10\%$ of $200 = (10/100) \\times 200 = 20$ (Page 1027)." },
                    { question: "What is 'profit'?", options: ["Selling price less.", "Selling price equal.", "Selling price greater.", "Revenue minus expenses."], correctOptionIndex: 2, explanation: "Profit = Selling Price - Cost Price (Page 1028)." },
                    { question: "What is 'loss'?", options: ["Selling price greater.", "Selling price less.", "Selling price equal.", "Revenue maximized."], correctOptionIndex: 1, explanation: "Loss = Cost Price - Selling Price (Page 1028)." },
                    { question: "If an item bought for $50 and sold for $60, what is profit percentage?", options: ["$10\%$", "$20\%$", "$25\%$", "$30\%$"], correctOptionIndex: 1, explanation: "Profit = $60 - 50 = 10$. Profit Percentage = $(10/50) \\times 100 = 20\%$ (Page 1029)." },
                    { question: "What is 'simple interest'?", options: ["Principal interest only.", "Principal plus interest.", "Annual interest.", "Daily compounded interest."], correctOptionIndex: 0, explanation: "Simple Interest = $P \\times R \\times T$ (Principal $\\times$ Rate $\\times$ Time) (Page 1030)." },
                    { question: "Calculate simple interest on $1000 at $5\%$ per annum for $2$ years.", options: ["$50", "$100", "$150", "$200$"], correctOptionIndex: 1, explanation: "Simple Interest = $1000 \\times 0.05 \\times 2 = 100$ (Page 1030)." },
                    { question: "What is 'compound interest'?", options: ["Principal interest only.", "Principal plus accumulated interest.", "Fixed interest.", "Decreasing interest."], correctOptionIndex: 1, explanation: "Compound interest leads to faster growth of money (Page 1031)." },
                    { question: "What is 'algebraic expression'?", options: ["Equation.", "Numbers, variables, operations.", "Single variable.", "Number sequence."], correctOptionIndex: 1, explanation: "An algebraic expression does not contain an equals sign, unlike an equation (Page 1032)." },
                    { question: "Simplify the expression: $3a + 4b - a + 2b$", options: ["$2a + 6b$", "$4a + 6b$", "$2a + 2b$", "$4a + 2b$"], correctOptionIndex: 0, explanation: "Combine like terms: $(3a - a) + (4b + 2b) = 2a + 6b$ (Page 1033)." }
                ];
                originalQuizQuestions.push(...mathematicsMCQs);

                // Remaining 20 MCQs will be additional science, social studies, English and Mathematics to reach 100.
                // General Science (Additional 5 MCQs from Pages 271-320)
                const generalScienceMCQs_add = [
                    { question: "What is 'reflection' of sound?", options: ["Sound bending.", "Sound bouncing.", "Sound absorbed.", "Sound in vacuum."], correctOptionIndex: 1, explanation: "Echoes are examples of sound reflection (Page 291)." },
                    { question: "What is 'refraction' of sound?", options: ["Sound bouncing.", "Sound bending medium.", "Sound absorbed.", "Sound straight line."], correctOptionIndex: 1, explanation: "Sound refraction explains why sound travels further over water at night (Page 292)." },
                    { question: "What is 'pitch' of sound?", options: ["Loudness.", "High/low sound.", "Quality.", "Speed."], correctOptionIndex: 1, explanation: "High frequency equals high pitch (Page 293)." },
                    { question: "What is 'loudness' of sound?", options: ["Perceived sound intensity.", "High/low sound.", "Quality.", "Speed."], correctOptionIndex: 0, explanation: "Loudness is measured in decibels (Page 294)." },
                    { question: "Which of the following is an example of a simple machine?", options: ["Television", "Washing machine", "Lever", "Computer"], correctOptionIndex: 2, explanation: "Simple machines include levers, pulleys, and inclined planes (Page 295)." }
                ];
                originalQuizQuestions.push(...generalScienceMCQs_add);

                // Social Studies (Additional 5 MCQs from Pages 591-618)
                const socialStudiesMCQs_add = [
                    { question: "What is 'sustainable development'?", options: ["Present needs met.", "Future needs met.", "Rapid growth.", "Technology only."], correctOptionIndex: 0, explanation: "Sustainable development balances economic, social, and environmental considerations (Page 608)." },
                    { question: "What is 'renewable energy'?", options: ["Runs out quickly.", "Continuously replenished.", "Fossil fuels.", "Causes pollution."], correctOptionIndex: 1, explanation: "Renewable energy sources include solar, wind, hydro, and geothermal (Page 609)." },
                    { question: "Which of the following is a non-renewable energy source?", options: ["Hydroelectric power", "Nuclear energy", "Biomass energy", "Tidal energy"], correctOptionIndex: 1, explanation: "Nuclear energy uses uranium, a finite resource (Page 610)." },
                    { question: "What is 'desertification'?", options: ["Forest expansion.", "Fertile land becomes desert.", "Increased rainfall.", "New rivers."], correctOptionIndex: 1, explanation: "Desertification is a major environmental problem (Page 611)." },
                    { question: "What is 'biodegradable waste'?", options: ["Non-decomposable.", "Broken down naturally.", "Plastic waste.", "Metal waste."], correctOptionIndex: 1, explanation: "Biodegradable waste can be composted (Page 612)." }
                ];
                originalQuizQuestions.push(...socialStudiesMCQs_add);

                // English (Additional 5 MCQs from Pages 871-894)
                const englishMCQs_add = [
                    { question: "Choose the correct sentence structure:", options: ["Walked dog I.", "I walked dog.", "Dog walked I.", "Walked I dog."], correctOptionIndex: 1, explanation: "Standard English sentence structure is Subject-Verb-Object (Page 891)." },
                    { question: "Identify the odd one out:", options: ["Apple", "Orange", "Banana", "Table"], correctOptionIndex: 3, explanation: "Table is an inanimate object; others are fruits (Page 892)." },
                    { question: "What is the past tense of 'eat'?", options: ["Eats", "Eaten", "Ate", "Eating"], correctOptionIndex: 2, explanation: "'Ate' is the simple past form of 'eat' (Page 893)." },
                    { question: "What is the comparative form of 'tall'?", options: ["Taller", "Tallest", "More tall", "Most tall"], correctOptionIndex: 0, explanation: "For most one-syllable adjectives, add '-er' for comparative (Page 894)." },
                    { question: "What is the superlative form of 'good'?", options: ["Gooder", "Goodest", "Better", "Best"], correctOptionIndex: 3, explanation: "Best' is the irregular superlative form of 'good' (Page 894)." }
                ];
                originalQuizQuestions.push(...englishMCQs_add);

                // Mathematics (Additional 5 MCQs from Pages 1021-1050)
                const mathematicsMCQs_add = [
                    { question: "Which property is shown: $a + b = b + a$?", options: ["Associative", "Commutative", "Distributive", "Identity"], correctOptionIndex: 1, explanation: "The commutative property states that the order of operands does not affect the result (Page 1034)." },
                    { question: "Which property is shown: $a(b + c) = ab + ac$?", options: ["Commutative", "Associative", "Distributive", "Identity"], correctOptionIndex: 2, explanation: "The distributive property explains how multiplication distributes over addition (Page 1035)." },
                    { question: "What is the value of $2^5$?", options: ["$10$", "$16$", "$25$", "$32$"], correctOptionIndex: 3, explanation: "$2^5 = 2 \\times 2 \\times 2 \\times 2 \\times 2 = 32$ (Page 1036)." },
                    { question: "What is the square root of $144$?", options: ["$10$", "$12$", "$14$", "$16$"], correctOptionIndex: 1, explanation: "The square root of a number is a value that, when multiplied by itself, gives the original number (Page 1037)." },
                    { question: "Find the missing number in the sequence: $2, 4, 6, 8, \\text{___}, 12$", options: ["$9$", "$10$", "$11$", "$13$"], correctOptionIndex: 1, explanation: "This is an arithmetic sequence with a common difference of $2$ (Page 1038)." }
                ];
                originalQuizQuestions.push(...mathematicsMCQs_add);


                // More MCQs to reach 100, ensuring content from other areas of the provided PDF
                // History (from pages 619-790) - 10 MCQs
                const historyMCQs = [
                    { question: "The Mughal Emperor known for compiling the 'Ain-i-Akbari' was:", options: ["Babur", "Humayun", "Akbar", "Jahangir"], correctOptionIndex: 2, explanation: "Ain-i-Akbari is a detailed document recording the administration of the Mughal Empire under Emperor Akbar. (Ref. Page 740)" },
                    { question: "The Partition of Bengal in $1905$ was orchestrated by which British Viceroy?", options: ["Lord Dalhousie", "Lord Curzon", "Lord Mountbatten", "Lord Ripon"], correctOptionIndex: 1, explanation: "Lord Curzon partitioned Bengal to weaken the growing nationalist movement, leading to widespread protests. (Ref. Page 765)" },
                    { question: "Who founded the Indian National Congress in $1885$?", options: ["Mahatma Gandhi", "Jawaharlal Nehru", "A.O. Hume", "Sardar Patel"], correctOptionIndex: 2, explanation: "The Indian National Congress was founded by a British civil servant, A.O. Hume, with the aim of creating a platform for civil and political dialogue among Indians. (Ref. Page 762)" },
                    { question: "The Battle of Panipat ($1526$) was fought between Babur and:", options: ["Sher Shah Suri", "Ibrahim Lodi", "Hemu", "Rana Sanga"], correctOptionIndex: 1, explanation: "This battle marked the beginning of the Mughal Empire in India, with Babur defeating the Delhi Sultan, Ibrahim Lodi. (Ref. Page 738)" },
                    { question: "Which major event led to the end of the East India Company's rule in India?", options: ["Battle of Buxar", "Revolt of $1857$", "Muslim League form.", "Salt March"], correctOptionIndex: 1, explanation: "The widespread rebellion of $1857$ directly led to the British Crown taking over administration from the East India Company. (Ref. Page 760)" },
                    { question: "The ancient city of Mohenjo-Daro is located in which modern-day country?", options: ["India", "Pakistan", "Afghanistan", "Iran"], correctOptionIndex: 1, explanation: "Mohenjo-Daro is a significant archaeological site of the Indus Valley Civilization, located in Sindh, Pakistan. (Ref. Page 620)" },
                    { question: "Who was the founder of the Mauryan Empire?", options: ["Ashoka", "Bindusara", "Chandragupta Maurya", "Samudragupta"], correctOptionIndex: 2, explanation: "Chandragupta Maurya established the vast Mauryan Empire in ancient India. (Ref. Page 630)" },
                    { question: "The 'Quit India Movement' was launched by Mahatma Gandhi in which year?", options: ["$1920$", "$1930$", "$1942$", "$1947$"], correctOptionIndex: 2, explanation: "The Quit India Movement was a significant civil disobedience movement launched during World War II, demanding an end to British rule in India. (Ref. Page 775)" },
                    { question: "The ancient Mesopotamian civilization developed between which two rivers?", options: ["Indus and Ganges", "Yellow and Yangtze", "Tigris and Euphrates", "Nile and Congo"], correctOptionIndex: 2, explanation: "Mesopotamia, meaning 'land between the rivers,' refers to the region between the Tigris and Euphrates rivers. (Ref. Page 620)" },
                    { question: "Which of the following was NOT a major cause of World War I?", options: ["Militarism", "Alliances", "Imperialism", "Great Depression"], correctOptionIndex: 3, explanation: "The Great Depression occurred much later ($1930s$) and was a cause of World War II, not World War I. (Ref. Page 780)" }
                ];
                originalQuizQuestions.push(...historyMCQs);
                
                // General Knowledge / Current Affairs / Pakistan Studies (10 MCQs - Implied from various sections/general context)
                const gkPakistanMCQs = [
                    { question: "Who was the first Governor-General of Pakistan?", options: ["Liaquat Ali Khan", "Muhammad Ali Jinnah", "Ayub Khan", "Ghulam Muhammad"], correctOptionIndex: 1, explanation: "Muhammad Ali Jinnah became the first Governor-General of Pakistan after its independence in $1947$. (General Pakistan Studies knowledge)" },
                    { question: "When did Pakistan gain independence?", options: ["Aug $14, 1947$", "Aug $15, 1947$", "Mar $23, 1940$", "Sep $11, 1948$"], correctOptionIndex: 0, explanation: "Pakistan celebrates its Independence Day on August $14$th each year. (General Pakistan Studies knowledge)" },
                    { question: "What is the capital city of Pakistan?", options: ["Lahore", "Karachi", "Islamabad", "Peshawar"], correctOptionIndex: 2, explanation: "Islamabad became the capital of Pakistan in $1960$, replacing Karachi. (General Pakistan Studies knowledge)" },
                    { question: "The highest peak in Pakistan is K2, also known as:", options: ["Mount Everest", "Nanga Parbat", "Godwin Austen", "Broad Peak"], correctOptionIndex: 2, explanation: "K2 is the second-highest mountain in the world and is often referred to as Mount Godwin Austen. (General Geography/Pakistan Studies knowledge)" },
                    { question: "The largest desert in Pakistan is the:", options: ["Thal Desert", "Cholistan Desert", "Thar Desert", "Kharan Desert"], correctOptionIndex: 2, explanation: "The Thar Desert extends into Pakistan and is the largest desert in Sindh province. (General Geography/Pakistan Studies knowledge)" },
                    { question: "Who wrote the national anthem of Pakistan?", options: ["Allama Iqbal", "M.A. Jinnah", "Hafeez Jalandhari", "Faiz Ahmed Faiz"], correctOptionIndex: 2, explanation: "The lyrics of the national anthem, 'Qaumi Taranah', were written by Hafeez Jalandhari. (General Pakistan Studies knowledge)" },
                    { question: "The 'Quaid-e-Azam' title refers to:", options: ["Allama Iqbal", "Liaquat Ali Khan", "Muhammad Ali Jinnah", "Zulfiqar Bhutto"], correctOptionIndex: 2, explanation: "Quaid-e-Azam, meaning 'Great Leader', is the honorary title given to Muhammad Ali Jinnah, the founder of Pakistan. (General Pakistan Studies knowledge)" },
                    { question: "The largest province of Pakistan by area is:", options: ["Punjab", "Sindh", "KPK", "Balochistan"], correctOptionIndex: 3, explanation: "Balochistan covers the largest land area among all provinces of Pakistan. (General Geography/Pakistan Studies knowledge)" },
                    { question: "The currency of Pakistan is:", options: ["Rupee", "Dollar", "Dinar", "Riyal"], correctOptionIndex: 0, explanation: "The official currency of Pakistan is the Pakistani Rupee (PKR). (General Knowledge)" },
                    { question: "The minimum age for voting in general elections in Pakistan is:", options: ["$16$ years", "$18$ years", "$21$ years", "$25$ years"], correctOptionIndex: 1, explanation: "Citizens who are $18$ years and above are eligible to vote in Pakistan. (General Civics/Pakistan Studies knowledge)" }
                ];
                originalQuizQuestions.push(...gkPakistanMCQs);

                // Randomly select one special question from the entire set on initial load
                // and store its ORIGINAL index. This ensures the same question is 'special'
                // across quiz restarts unless the data is explicitly reloaded.
                specialQuestionOriginalIndex = Math.floor(Math.random() * originalQuizQuestions.length);
            }

            // Create a fresh copy of questions for the current quiz attempt
            quizQuestions = JSON.parse(JSON.stringify(originalQuizQuestions));

            // Mark the special question in the current quizQuestions array
            quizQuestions[specialQuestionOriginalIndex].special = true;

            // Shuffle the entire quiz question order
            shuffleArray(quizQuestions);

            // After shuffling, ensure the 'special' flag is correctly assigned to the intended question
            // The shuffle operation might move the original special question. We need to re-find it
            // and ensure its 'special' property is true, and others are false.
            let foundSpecial = false;
            quizQuestions.forEach((q, index) => {
                if (q.special && !foundSpecial) { // If this is the originally marked special question (and we haven't found it yet)
                    // Keep it marked special
                    foundSpecial = true;
                } else {
                    q.special = false; // Ensure all others are not marked special
                }
            });

            // If somehow the special question got lost or unmarked during deep copy/shuffle, re-assign one
            if (!foundSpecial) {
                const newSpecialIndex = Math.floor(Math.random() * quizQuestions.length);
                quizQuestions[newSpecialIndex].special = true;
                // Update specialQuestionOriginalIndex to reflect this newly chosen special question's original index
                specialQuestionOriginalIndex = originalQuizQuestions.findIndex(originalQ =>
                    JSON.stringify(originalQ) === JSON.stringify(quizQuestions[newSpecialIndex])
                );
            }
        }

        // Load MathJax for rendering LaTeX
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
        script.async = true;
        document.head.appendChild(script);

        // Initialize the quiz when the script loads
        initializeQuiz();
        // Explicitly show the login page after initialization to prevent any display issues
        showPage('loginPage');
    </script>
</body>
</html>
